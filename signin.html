<!--Required meta tags-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="Film and Photography">
    <meta name="keywords" content="HTML, CSS, jQuery, JavaScript and JSON">
    <meta name="author" content="Tshegofatso Given Ditau Motswagae">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Bootstrap, FontAwesome, then CSS-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/signin-styles.css">
    <link rel="stylesheet" type="text/css" href="css/fontawesome-all.css">

    <!--jQuery-->
    <script type="text/javascript" src="js/jquery-3.4.1.js"></script>

    <title>Sign in</title>
</head>
<body>

    <!--Business Intelligence-->
    <script type="text/javascript">

        //Create a cookie
        function setCookie(cookie_name, cookie_value) {
            try {
                document.cookie = cookie_name + "=" + cookie_value;
            }
            catch (ex) {
                alert(ex.message);
            }
        }

        //Collect the cookie session
        function getCookie(cookie_name) {
            try {
                var name = cookie_name + "=";
                var ca = document.cookie.split(";");
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == " ") c = c.substring(1);
                    if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
                }
                return "";
            }
            catch (ex) {
                alert(ex.message);
            }
        }

        //Set cookie session variable
        var userstr = getCookie("username");

        //Verify active session
        function verifyActiveSession(loggedin) {
            try {
                if (Boolean(loggedin)) {
                    document.getElementById("userstr0").innerHTML = userstr;
                    document.getElementById("navbar-inactive-session").remove();
                    window.location.replace("invoices.html");
                }
                else {
                    document.getElementById("userstr1").innerHTML = "Guest";
                    document.getElementById("navbar-active-session").remove();
                }
            }
            catch (ex) {
                alert(ex.message);
            }
        }

        //Confirm active session
        window.addEventListener("DOMContentLoaded", function () {
            try {
                if (userstr != "") {
                    verifyActiveSession(true);
                }
                else {
                    verifyActiveSession(false);
                }
            }
            catch (ex) {
                alert(ex.message);
            }
        });

        //Verify user account
        function validateForm() {
            try {
                var txtUsername = document.getElementById("txtUser").value;
                //var expression = new RegExp(txtUsername, "i");
                var txtPassword = document.getElementById("txtPass").value;

                //var userInfo = fetch("/includes/eoifilms.json")
                //    .then(response => { return response.json(); })
                //    .then(data => console.log(data));

                //var userNames = [];
                //var userPassword = [];

                //var userData = fetch("/includes/data.json")
                //    .then(response => { return response.json(); })
                //    .then(data => { userNames = data.UserName, userPassword = data.UPassWord });


                //$.getJSON("includes/data.json", function(data) {
                //    $.each(data, function (key, value) {
                //        if (value.UserName.search(expression) != -1) {
                //            alert("match found");
                //        }
                //        else {
                //            alert("Username or Password is invalid!");
                //        }
                //    });
                //});

                var userInfo = {
                    "users": [
                        {
                            "ID": 1,
                            "Name": "Tshegofatso Given Ditau",
                            "Surname": "Motswagae",
                            "UserName": "Tshegofatso",
                            "UPassWord": "HRg73KRK"
                        },
                        {
                            "ID": 2,
                            "Name": "Bokang Trevor",
                            "Surname": "Rakgalakane",
                            "UserName": "Trevor",
                            "UPassWord": "2pYvgrpk"
                        },
                        {
                            "ID": 3,
                            "Name": "Onika",
                            "Surname": "Moloto",
                            "UserName": "Onika",
                            "UPassWord": "sRraB9MF"
                        }
                    ]
                }
                var confirmAccount = userInfo.users.filter(function (account) {
                    return account.UserName === txtUsername && account.UPassWord === txtPassword;
                });
                if (confirmAccount != "") {
                    setCookie("username", txtUsername);
                    sessionStorage.setItem("ssusername", txtUsername);
                    setInterval(function () { window.location.replace("signin.html") }, 1000);
                }
                else {
                    alert("Username or Password is invalid!");
                }
            }
            catch (ex) {
                alert(ex.message);
            }
        }

    </script>

    <!--Navbar-->
    <div id="navbar-active-session">
        <nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="index.html">EOI Films</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#" id="userstr0">Guest<span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="invoices.html">Invoices</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="custom-invoices.html">Custom invoices</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="signout.html">Sign out</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <div id="navbar-inactive-session">
        <nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="index.html">EOI Films</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="signin.html" id="userstr1">Guest<span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="signin.html">Sign in</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    
    <!--Content-->
    <div id="content-active-session">
        <div class="content">
            <div class="content-inside">

                <!--Sign in form-->
                <h1 class="mb-4 font-weight-light text-center"><strong>Sign in</strong></h1>

                <div class="form-row">
                    <div class="form-group col-md-4 mx-auto">
                        <label for="inputUsername">Username</label>
                        <input type="text" class="form-control" placeholder="Username" maxlength="50" name="user" id="txtUser" required autofocus>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-4 mx-auto">
                        <label for="inputPassword">Password</label>
                        <input type="password" class="form-control" placeholder="Password" maxlength="10" name="pass" id="txtPass" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-4 mx-auto">
                        <button id="sign-in-btn" type="submit" class="btn btn-dark col-md-12" name="Send" onclick="return validateForm();">Sign in</button>
                    </div>
                </div>

                <p class="mt-3 font-weight-normal text-center">Only available to EOI Films <strong>family.</strong></p>

            </div>
        </div>
    </div>

    <!--footer-->
    <footer>
        <div class="footer-content">
            <div class="footer-icons">
                <ul>
                    <li><a class="nav-link px-2" href="https://www.instagram.com/eoifilms/" target="_blank"><i class="fab fa-instagram"></i></a></li>
                    <li><a class="nav-link px-2" href="mailto:info@eoifilms.co.za"><i class="fa fa-envelope"></i></a></li>
                </ul>
            </div>

            <p style="font-size:x-small;">
                Copyright &copy;
                <script>document.write(new Date().getFullYear());</script> EOI Films. All Rights Reserved.
            </p>
        </div>
    </footer>

    <!--Popper.js, then Bootstrap JS and Others-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/signin-script.js"></script>
    <script type="text/javascript" src="js/fontawesome-all.js"></script>
    <script type="text/javascript" src="js/jspdf.min.js"></script>

</body>
</html>